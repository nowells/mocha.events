/*! mocha.events 0.0.2 (2013-09-07) */
!function(a,b){"undefined"!=typeof exports?b(a,exports,require("backbone"),require("underscore"),require("sinon"),require("chai")):"function"==typeof define&&define.amd?define(["underscore","backbone","sinon","chai","jquery","exports"],function(c,d,e,f,g,h){return a.MochaEvents=b(a,h,d,c,e,f,g),a.MochaEvents}):a.MochaEvents=b(a,{},a.Backbone,a._,a.sinon,a.chai,a.jQuery||a.Zepto||a.ender||a.$)}(this,function(a,b,c,d,e,f,g){"use strict";function h(a){return g._data?g._data(a.get(0)).events||{}:a.data("events")}var i=f.expect,j=f.assert,k=a.afterEach,l=a.beforeEach,m=a.it,n=a.describe,o="check_pre_existing_leak",p=[],q=[],r=[];return c.Events.on(o,function(){}),g(a).on(o,function(){}),function(){var b;b=function(){var b=0,c=0;d(p).each(function(a){a._events&&d(a._events).each(function(c){d(c).each(function(c){c.context===a||c.preExisting||(b+=1)},this)},this)},this),j(0===b,"There are still "+b+" active Backbone event listeners created in: "+this.currentTest.title),c=0,d(q).each(function(b){var e=h(b);e&&d(e).size()>0&&d(e).each(function(e,f){d(e).each(function(e){var g=-1===d(r).indexOf(e.guid);g&&b!==a&&"unload"!==f&&(c+=1)},this)},this)},this),j(0===c,"There are still "+c+" active jQuery event listeners created in: "+this.currentTest.title)};var f;l(function(){var a,b,i;f=e.sandbox.create(),p=[c.history,c.Events],a=function(a){return function(){this._eventLeakRegister||(this._eventLeakRegister=!0,p.push(this)),a.apply(this,arguments)}},b=d(function(b){f.stub(b,"on",a(b.on))}).bind(this),b(c.Model.prototype),b(c.View.prototype),b(c.Collection.prototype),b(c.Router.prototype),d(p).each(function(a){d(a._events).each(function(a){d(a).each(function(a){a.preExisting=!0})})}),q=[],i=g.fn.on,r=[],f.stub(g.fn,"on",function(){if(!this._eventLeakRegister){this._eventLeakRegister=!0,q.push(this);var a=h(this);a&&d(a).each(function(a){d(a).each(function(a){r.push(a.guid)})})}return i.apply(this,arguments)})}),k(function(){f.restore(),b.call(this)}),n("setup",function(){n("events",function(){var e,f=function(){};l(function(){e=d(function(){b.call(this)}).bind(this)}),m("should exclude pre-existing Backbone events from being considered leaks",function(){var a=function(){};i(c.Events._events[o]).to.be.an("array"),i(c.Events._events[o].length).to.equal(1),i(e).to.not.throw(),c.Events.on(o,a);try{i(c.Events._events[o].length).to.equal(2),i(e).to.throw(),c.Events.off(o,a),i(c.Events._events[o].length).to.equal(1),i(e).to.not.throw()}finally{c.Events.off(o,a)}}),m("should exclude pre-existing jQuery events from being considered leaks",function(){var b=function(){},c=g(a);i(h(c)[o]).to.be.an("array"),i(h(c)[o].length).to.equal(1),i(e).to.not.throw(),c.on(o,b);try{i(h(c)[o].length).to.equal(2),i(e).to.throw(),c.off(o,b),i(h(c)[o].length).to.equal(1),i(e).to.not.throw()}finally{c.off(o,b)}}),m("should raise an exception if all Backbone.Model events are not unregistered",function(){var a=new c.Model;a.on("change",f),i(e).to.throw(),a.off("change",f),i(e).to.not.throw()}),m("should raise an exception if all Backbone.View events are not unregistered",function(){var a=new c.View;a.$el.off("remove",a.remove),a.on("change",f),i(e).to.throw(),a.off("change",f),i(e).to.not.throw()}),m("should raise an exception if all Backbone.Collection events are not unregistered",function(){var a=new c.Collection;a.on("change",f),i(e).to.throw(),a.off("change",f),i(e).to.not.throw()}),m("should raise an exception if all Backbone.Router events are not unregistered",function(){var a=new c.Router;a.on("change",f),i(e).to.throw(),a.off("change",f),i(e).to.not.throw()}),m("should raise an exception if all Backbone.Events events are not unregistered",function(){c.Events.on("change",f),i(e).to.throw(),c.Events.off("change",f),i(e).to.not.throw()}),m("should raise an exception if all Backbone.history events are not unregistered",function(){c.history.on("change",f),i(e).to.throw(),c.history.off("change",f),i(e).to.not.throw()}),m("should raise an exception if all jQuery events registerd with $(...).on(...) are not unregistered",function(){g(a).on("resize",f),i(e).to.throw(),g(a).off("resize",f),i(e).to.not.throw()}),m("should raise an exception if all jQuery events registered with $(...).ACTION(...) are not unregisterd",function(){g(a).click(f),i(e).to.throw(),g(a).off("click",f),i(e).to.not.throw()})})})}});
//# sourceMappingURL=mocha.events.min.map